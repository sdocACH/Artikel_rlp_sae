
% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %

\section{Terrestrial sampling design of the German NFI}
\label{sec:germanNFI}

The German NFI is a periodic inventory that is carried out every 10 years over the entire forest area of Germany. The most recent inventory (BWI3) was conducted in 2011 and 2012. While information was originally gathered on a systematic 4x4 km grid, some federal states such as Rhineland-Palatinate have switched to a densified 2x2 km grid. The German NFI uses a cluster sampling design, which means that a sample unit consists of at most four sample locations (also referred to as \textit{sample plots}) that are arranged in a square, called \textit{cluster}, with a side length of 150 metres. The number of plots per cluster can vary between 1 and 4 depending on forest/non-forest decisions by the field crews on the individual plot level \citep{bwi3_aufn}. In the field survey of the BWI3, sample trees for timber volume estimation are selected according to the angle count sampling technique \citep{bitterlich1984}, using a basal area factor ($BAF$) of 4 that is respectively adjusted for sample trees at the forest boundary by a geometric intersection of the boundary transect with the individual tree's inclusion circle \citep{bwi3_aufn}. A further inventory threshold for a tree to be recorded is a diameter at breast height ($DBH$) of at least 7 cm. For each sample tree that is selected by this procedure, the DBH, the absolute tree height, the tree diameter at 7 m ($D7$) and the tree species is measured and used to estimate the volume at the tree level. These volume estimates are based on the application of tree species specific taper curves that are adjusted to the set of diameters and corresponding height measurements taken from the respective sample tree \citep{kublin2013}.

% ++++++++++++ %
\section{Double sampling in the infinite population approach}
\label{sec:inf_pop}

% \subsubsection{One- and Two-Phase Sampling in the Infinite Population Approach}

The estimators used in this study have been proposed by \citep{mandallaz2013a,mandallaz2013b} and derive their mathematical properties under the so-called infinite population approach. Therefore, we shall first provide a short introduction into this general estimation framework. We start by assuming that the population $P$ of trees $i \in 1,2, ..., N$ within a forest of interest $F$ is exactly defined, and each tree $i$ has a response variable $Y_i$ (e.g. its timber volume) that can be used to define the population mean $Y$ (e.g., the average timber volume per unit area) over $F$. Since a full census of all tree population individuals is almost never feasible, $Y$ has to be estimated based on a sample. In the infinite population approach this sample is a set of points or locations $x$ distributed independently and uniformly over the set of all possible points in $F$. Each point $x$ has an associated local density $Y(x)$ (e.g., the timber volume per unit area) whose spatial distribution is given by a fixed (i.e. non stochastic) piecewise constant function. The population mean $Y$ is mathematically equivalent to the integral of the local density function surface divided by the surface area of $F$, $\lambda(F)$, i.e. $Y=\frac{1}{N} \sum_{i=1}^{N}Y_i=\frac{1}{\lambda(F)}\int_{F}Y(x)dx$, and thus the population mean $Y$ corresponds to a spatial mean. Since the actual local density function is unobserved in its entirety, one estimates $Y$ by taking a sample $s_2$ consisting of $n_2$ points and measuring each of their respective local densities. This sampling procedure is often referred to as \textit{one-phase sampling} (OPS) and $s_2$ is referred to as the terrestrial inventory. In contrast to the one-phase approach, \textit{two-phase} or \textit{double-sampling} procedures use information from two nested samples (phases). Practically speaking, the terrestrial inventory $s_2$ is embedded in a large phase $s_1$ comprising $n_1$ sample locations that each provide a set of explanatory variables described by the column vector $\pmb{Z}(x)=(z(x)_1, z(x)_2,...,z(x)_p)^{\top}$ at each point $x \in s_1$. These explanatory variables are derived from auxiliary information that is available in high quantity within the forest $F$. For every $x \in s_1$, $\pmb{Z}(x)$ is transformed into a prediction $\hat{Y}(x)$ of $Y(x)$ using the choice of some prediction model. The basic idea of this method is to boost the sample size by providing a large sample of less precise but cheaper predictions of $Y(x)$ in $s_1$ and to correct any possible model bias, i.e., $\EX{(Y(x)-\hat{Y}(x))}$, using the subsample of terrestrial inventory units where the value of $Y(x)$ is observed.

% which in \pkg{forestinventory} is always a linear model fit in $s_2$ using ordinary least squares (OLS).
%The one-phase and two-phase estimators applied in this study have been implemented in the software-package \textit{forestinventory} \cite{forestinventory} 
% The local density $Y(x)$ is in practice derived by ...
% extend the approach to collecting auxiliary information ...
% say that we also assume that the forest area is well-defined ...

% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\section{Estimators}
\label{sec:estimators}


% ++++++++++++ %
\subsection{Design-based one-phase estimator for cluster sampling (SRS)}
\label{sec:srs_estimator}

The one-phase estimator for cluster sampling (SRS) constitutes the \textit{status quo} that is currently applied under the existing one-phase sampling design of the German NFI in order to obtain point and variance estimates for the mean timber volume of a given estimation unit. In order to provide all estimators in the infinite population framework and ensure a consistent terminology with the two-phase estimators in Section \ref{sec:SAestimators}, we will introduce the SRS estimator that is applied in the BWI3 algorithms \citep{bwi3_ausw} in the form given in \citet{mandallaz2008, mandallaz2016}.\par 
In order to calculate the local density $Y_{c}(x)$ at the cluster level, a cluster is defined as consisting of $M$ sample locations (in the BWI3, we have $M=4$ ) where $M-1$ sample locations $x_2, ..., x_M$ are created close to the cluster origin $x_1$ by adding a fixed set of spatial vectors $e_2, ..., e_M$ to $x_1$. The actual number of plots per cluster, $M(x)$, is a random variable due to the uniform distribution of $x_l$ ($l=1, ..., M$) in the forest $F$ and to the forest/non-forest decision for each sample location $x_l$:

\begin{equation}\label{eq:Mx}
M(x)=\sum_{l=1}^{M}I_{F}(x_l) \hspace{3ex} \text{where} \hspace{3ex} I_F(x_l)=\begin{cases}&1 \text{ if $x_l \in F$}\\
&0 \text{ if $x_l\not\in F$}
\end{cases}
\end{equation}

The local density on cluster level $Y_{c}(x)$, which is in our case the timber volume per hectare, is then defined as the average of the individual sample plot densities $Y(x_l)$:

\begin{equation}\label{eq:locdens_clust}
Y_{c}(x) = \frac{\sum_{l=1}^{M} I_{F}(x_{l}) Y(x_l)}{M(x)}
\end{equation}

The local density $Y(x_l)$ on individual sample plot level was calculated according to the description in \citet{mandallaz2008}, which can be rewritten for angle-count sampling technique applied in the BWI3. The general form of $Y(x)$ in \citet{mandallaz2008} is given as the Horwitz-Thompson estimator 

%\begin{equation}\label{locdens_plot}
%Y(x)= \sum_{i=1}^{F}\frac{I_{i}(x)Y_i}{\varPi_{i}\lambda(F)} = \sum_{i \in s_{2}(x)}\frac{Y_i}{\varPi_{i}\lambda(F)}
%\end{equation}

\begin{equation}\label{eq:locdens_plot}
Y(x_l)=\sum_{i \in s_{2}(x_l)}\frac{Y_i}{\pi_{i}\lambda(F)}
\end{equation}

\noindent where $Y_i$ is in our case the timber volume of the tree $i$ recorded at sample location $x$ in m$^3$. Each tree has an inclusion probability $\pi_{i}$ that is well defined as the proportion of its inclusion circle area $\lambda(K_i)$ within the forest area $\lambda(F)$, i.e. via their geometric intersection:

%with the binary indicator variable $Ii$ for the $i$th tree defined as
%
%\begin{equation}\label{1stage}
%I_i(x)=\begin{cases}&1 \text{ if $x \in K_i$}\\
%&0 \text{ if $x\not\in K_i$}
%\end{cases}
%\end{equation}

\begin{equation}\label{locdens_plot_1}
\pi_{i} = \frac{\lambda(K_i \cap F)}{\lambda(F)}
\end{equation}

The radius $R_i$ of the tree's inclusion circle $K_i$ is given by $R_i = DBH_{i}/cf_{i,corr}$ (also referred to as \textit{limiting distance}), where $cf_{i,corr}$ is the original counting factor $cf$ corrected for potential boundary effects at the forest border. In case of angle-count sampling, we can rewrite $\pi_{i}$ as

\begin{equation}\label{eq:locdens_plot_2}
\pi_{i} = \frac{G_i}{cf_{i,corr}\lambda(F)}
	\end{equation}

\noindent since the intersection area $\lambda(K_i \cap F)/\lambda(F)$ can be expressed using the trees basal area $G_i$ (in m$^2$) and the corrected counting factor:

\begin{equation}\label{eq:locdens_plot_3}
\lambda(K_i \cap F) = \frac{G_i}{cf_{i, corr}} \hspace{3ex} \text{where} \hspace{3ex} cf_{i,corr} = cf\frac{\lambda(K_i)}{\lambda(K_i \cap F)}
\end{equation}

Eq. \ref{eq:locdens_plot_2} in Eq. \ref{eq:locdens_plot} yields the rewritten form of $Y(x_l)$ for angle count sampling that conforms to the definition used in the BWI3 algorithms \citep{bwi3_ausw}:

\begin{equation}\label{eq:locdens_plot_4}
Y(x_l)= \sum_{i \in s_{2}(x_l)} \frac{cf_{i, corr}Y_i}{G_i} = \sum_{i \in s_{2}(x_l)} nha_{i}{Y_i}
\end{equation}

\noindent where $nha_i$ is the number of trees per hectare represented by tree $i$. The local densities on cluster level can then be used to derive the estimated spatial mean $\hat{\bar{Y}}_c$ and its estimated variance $\hat{\var}(\hat{\bar{Y}}_c)$ for any given spatial unit for which $n_2 \geq 2$ ($n_2$ denoting the number of clusters):

\begin{subequations}\label{eq:srs_est_clusters}
	\begin{align}
\hat{\bar{Y}}_c &= \frac{\sum_{x \in s_2} M(x) Y_{c}(x)}{\sum_{x \in s_2} M(x)} \\
\hat{\var}(\hat{\bar{Y}}_c) &= \frac{1}{n_2(n_2 - 1)}\sum_{x \in s_2}\Big(\frac{M(x)}{\bar{M_2}}\Big)^2(Y_{c}(x) - \hat{\bar{Y}}_c)^2
	\end{align}
\end{subequations}

with $\bar{M_2}=\frac{\sum_{x \in s_{2}}M(x)}{n_{2}}$.

% \newpage

% +++++++++++++++++++++++++++++ %
\subsection{Design-based small area regression estimators for cluster sampling}
\label{sec:SAestimators}

All three considered small area estimators use ordinary least square (OLS) regression models to produce predictions of the local density $Y_{c}(x)$ directly on the cluster level $c$. We consider the internal model approach, where the estimators take into account that the regression coefficients on the cluster level were fitted using the same sample used for estimation. To apply this to small area estimation, the vector of estimated regression coefficients on the cluster level is found by "borrowing strength" from the entire terrestrial sample $s_2$ of the current inventory:

\begin{subequations}\label{normequ_simple_cluster}
	\begin{align}
\hat{\pmb{\beta}}_{c,s_2} &= \pmb{A}_{c,s_2}^{-1} \Big(\frac{1}{n_2}\sum_{x\in{s_2}}M(x)Y_{c}(x)\pmb{Z}_{c}(x)\Big) \\
\pmb{A}_{c,s_2} &=\frac{1}{n_2}\sum_{x\in{s_2}}M(x)\pmb{Z}_{c}(x)\pmb{Z}_{c}^{\top}(x)
	\end{align}
\end{subequations}

\noindent $\pmb{Z}_{c}(x)$ is the vector of explanatory variables on the cluster level, which is calculated as the weighted average of the explanatory variables $\pmb{Z}(x_l)$ on the individual plot levels $x_1, ..., x_l$ (Eq.\ref{eq:Zc(x)}). The weight $w(x_l)$ is the proportion of the support-area within the forest $F$ used to derive the explanatory variables from the raw auxiliary information.

\begin{equation}\label{eq:Zc(x)}
\pmb{Z}_{c}(x)=\frac{\sum_{l=1}^{M}I_{F}(x_l)w(x_l)\pmb{Z}(x_l)}{\sum_{l=1}^{M}I_{F}(x_l)w(x_l)}
\end{equation}

\noindent The estimated design-based variance-covariance matrix $\hat{\pmb{\Sigma}}_{\hat{\pmb{\beta}}_{c,s_2}}$ accounts for the fact that the regression model is internal and reflects the sampling variability that occurs when estimating the regression coefficients on the realized sample $s_2$. It is defined as

\begin{equation}\label{eq:varcovarbeta}
\hat{\pmb{\Sigma}}_{\hat{\pmb{\beta}}_{c,s_2}}=\pmb{A}_{c,s_2}^{-1}
\Big(\frac{1}{n_2^2}\sum_{x\in{s_2}}M^{2}(x)\hat{R}_{c}^2(x)\pmb{Z}_{c}(x)\pmb{Z}_{c}^{\top}(x)\Big)
\pmb{A}_{c,s_2}^{-1}
\end{equation}

\noindent with 

\begin{equation}\label{eq:globresids}
\hat{R}_{c}=Y_{c}(x)-\pmb{Z}_{c}^{\top}(x)\hat{\pmb{\beta}}_{c,s_2} = Y_{c}(x) - \hat{Y}_{c}(x)
\end{equation}

\noindent being the empirical model residuals at the cluster level, which by construction of OLS satisfy the important zero mean residual property, i.e. $\frac{\sum_{x \in s_{2}} M(x) \hat{R}_{c}(x)}{\sum_{x \in s_{2}} M(x)}=0$.\\

In the following, we will give a short description of each small area estimator and refer to \citet{mandallaz2013a, mandallaz2016, mandallaz2013b} if the reader requires additional details or proofs. The estimators have also been implemented in the R-package \textit{forestinventory} \citep{forestinventory} which was used to compute all estimates in this study.\\



% ----------------------------- %
% PSMALL estimator:
\subsubsection{Pseudo Small Area Estimator (\psmall{})}
\label{sec:psmall}
% \textbf{Pseudo Small Area Estimator (\psmall{})}\\

All point information used for small area estimation is now restricted to that available at the sample locations $s_{1,G}$ or $s_{2,G}$ in the small area $G$, with exception of $\hat{\pmb{\beta}}_{c,s_2}$ and $\hat{\pmb{\Sigma}}_{\hat{\pmb{\beta}}_{c,s_2}}$ which are always based on the entire sample $s_2$. We thus first define the following quantities on the small area level:

\begin{subequations}\label{eq:compsG}
	\begin{align}
	\hat{\bar{\pmb{Z}}}_{c,G} &= \frac{\sum_{x \in s_{1,G}} M_{G}(x) \pmb{Z}_{c,G}(x)}{\sum_{x \in s_{1,G}} M_{G}(x)} \label{eq:meanZcG} \hspace{3ex} &\text{where} \hspace{3ex}
	\pmb{Z}_{c,G}(x) =  \frac{\sum_{l=1}^{L} I_{G}(x_l)\pmb{Z}(x_l)}{M_{G}(x)}\\		
	Y_{c,G}(x) &= \frac{\sum_{l=1}^{L} I_{G}(x_l)Y(x_l)}{M_{G}(x)}  &\text{and} \hspace{3ex}
	\hat{Y}_{c,G}(x)=\hat{\bar{\pmb{Z}}}_{c,G}^{\top}\hat{\pmb{\beta}}_{c,s_2}\\
	\bar{\hat{R}}_{2,G} &= \frac{\sum_{x \in s_{2,G}} M_{G}(x) \hat{R}_{c,G}(x)}{\sum_{x \in s_{2,G}} M_{G}(x)} \hspace{3ex} &\text{where} \hspace{3ex}
	\hat{R}_{c,G}(x) = Y_{c,G}(x)-\hat{Y}_{c,G}(x)
	\end{align}
\end{subequations}

Note that the restriction to $G$, i.e. $I_{G}(x_l)=\{0,1\}$, is made on the individual sample plot level $x_l$, and $M_{G}(x) = \sum_{l=1}^{L}I_{G}(x_l)$ thus is the number of sample plots per cluster within the small area. The asymptotically design-unbiased point estimate of \textit{PSMALL} is then defined according to Eq. \ref{eq:psmall_pest}. The first term estimates the small area population mean of $G$ by applying the globally derived regression coefficients to the small area cluster means of the explanatory variables $\hat{\bar{\pmb{Z}}}_{c,G}$. The second term then corrects for a potential bias of the regression model predictions in the small area $G$ by adding the mean of the empirical residuals $\bar{\hat{R}}_{2,G}$ in $G$. This correction is necessary because the zero mean residual property that holds in $F$ is not guaranteed to hold in small area $G$ under this construction.

\begin{subequations}\label{eq:psmall}
	\begin{align}
	\hat{Y}_{c,G,PSMALL} &= \hat{\bar{\pmb{Z}}}_{c,G}^{\top}\hat{\pmb{\beta}}_{c,s_2} + \bar{\hat{R}}_{2,G} \label{eq:psmall_pest} \\
	\hat{\var}(\hat{Y}_{c,G,PSMALL}) & = \hat{\bar{\pmb{Z}}}_{c,G}^{\top}\hat{\pmb{\Sigma}}_{\hat{\pmb{\beta}}_{c,s_2}}\hat{\bar{\pmb{Z}}}_{c,G}
	+ \hat{\pmb{\beta}}_{c,s_2}^{\top}\hat{\Sigma}_{\hat{\bar{\pmb{Z}}}_{c,G}}\hat{\pmb{\beta}}_{c,s_2} \nonumber \\
	& + \frac{1}{n_{2,G}(n_{2,G}-1)}\sum_{x \in s_{2,G}}\Big(\frac{M_{G}(x)}{\bar{M}_{2,G}}\Big)^2(\hat{R}_{c,G}(x) - \bar{\hat{R}}_{2,G})^2
	\label{eq:psmallvar}
	\end{align}
\end{subequations}

The variance-covariance matrix of the auxiliary vector $\hat{\Sigma}_{\hat{\bar{\pmb{Z}}}_{c,G}}$ is thereby defined as

\begin{equation}\label{estvarcovaux_G}
\hat{\Sigma}_{\hat{\bar{\pmb{Z}}}_{c,G}} = \frac{1}{n_{1,G}(n_{1,G}-1)} \sum_{x \in s_{1,G}} \big(\frac{M_{G}(x)}{\bar{M}_{1,G}}\big)^2 (\pmb{Z}_{c,G}(x)-\hat{\bar{\pmb{Z}}}_{c,G})(\pmb{Z}_{c,G}(x)-\hat{\bar{\pmb{Z}}}_{c,G})^{\top}
\end{equation}

with $\bar{M}_{1,G}=\frac{\sum_{x \in s_{1,G}}M_{G}(x)}{n_{1,G}}$.\\

The estimated design-based variance of $ \hat{Y}_{c,G,PSMALL}$ is given by Eq. \ref{eq:psmallvar}. Basically, the first term constitutes the variance introduced by the uncertainty in the regression coefficients, whereas the second term expresses the variance caused by estimating the exact auxiliary mean in $G$ using a non-exhaustive sample $s_{1,G}$. The third term is the variance of the model residuals and thus accounts for the inaccuracies of the model predictions. Note that the first term can also be rewritten using g-weights \cite[pg.14]{mandallaz2016} which ensures some beneficial calibration of the auxiliary variables to the first-phase sample.\\


% ----------------------------- %
% PSYNTH estimator:
\subsubsection{Pseudo Synthetic Estimator (\psynth{})}
\label{sec:psynth}
% \textbf{Pseudo Synthetic Estimator (\psynth{})}\\

The \psynth{} estimator is commonly applied when no terrestrial sample is available within the small area $G$ (i.e. $n_{2,G}=0$). The point estimate (Eq. \ref{eq:psynth_pest}) is thus only based on the predictions generated by applying the globally derived regression coefficients to the small area cluster means of the explanatory variables $\hat{\bar{\pmb{Z}}}_{c,G}$. Note that the bias correction term using the empirical residuals (Eq. \ref{eq:psmall_pest}) can no longer be applied. The \psynth{} estimator thus has a potential unobservable design-based bias.

\begin{subequations}\label{eq:psynth}
	\begin{align}
	\hat{Y}_{c,G,PSYNTH} & =\hat{\bar{\pmb{Z}}}_{c,G}^{\top}\hat{\pmb{\beta}}_{c,s_2} \label{eq:psynth_pest} \\
	\hat{\var}(\hat{Y}_{c,G,PSYNTH})& =
	\hat{\bar{\pmb{Z}}}_{c,G}^{\top}\hat{\pmb{\Sigma}}_{\hat{\pmb{\beta}}_{c,s_2}}
	\hat{\bar{\pmb{Z}}}_{c,G}
	+ \hat{\pmb{\beta}}^{\top}_{c,s_2}\hat{\Sigma}_{\hat{\bar{\pmb{Z}}}_{c,G}}\hat{\pmb{\beta}}_{c,s_2} \label{eq:psynth_var}
	\end{align}
\end{subequations}

The contribution to the variance by the model residuals in small area $G$ can also no longer be considered (Eq. \ref{eq:psynth_var}). As a result, the synthetic estimator will usually have a smaller variance than estimators that consider the model residuals, but at the cost of a potential bias. Note that the \psynth{} estimator is still design-based, but one purely has to rely on the validity of the regression model within the small area as it is the case in the model-dependent framework.\\

% ----------------------------- %
% EXTPSYNTH estimator:
\subsubsection{Extended Pseudo Synthetic Estimator (\extpsynth{})}
\label{sec:extpsynth}
% \textbf{Extended Pseudo Synthetic Estimator (\extpsynth{})}\\

The \extpsynth{} estimator (Eq. \ref{eq:extpsynth}) has been proposed by \cite{mandallaz2013a} as a transformed version of the \psmall{} estimator that has the form of the \psynth{} estimator but remains asymptotically design unbiased. It has the advantage that the mean of the empirical model residuals of the OLS regression model for the entire area $F$ and the small area $G$ are by construction both zero at the same time, i.e. $\bar{\hat{R}}_{c} = \bar{\hat{R}}_{c,G} = 0$. This is realized by \textit{extending} the auxiliary vector $\pmb{Z}_{c}(x)$ by the indicator variable $I_{c,G}$ which takes the value 1 if the entire cluster lies within the small area $G$ and 0 if the entire cluster is outside $G$, i.e. $I_{c,G}(x)=\frac{M_{G}(x)}{M(x)}$. The extended auxiliary vector thus becomes $\pmb{\mathbb{Z}}_{c}^{\top}(x)= (\pmb{Z}_{c}^{\top}(x),I_{c,G}(x))$ and the new regression coefficient using $\pmb{\mathbb{Z}}_{c}(x)$ instead of $\pmb{Z}_{c}(x)$ in Eq. \ref{normequ_simple_cluster} is denoted as $\hat{\pmb{\theta}}_{s_2}$. All remaining components are calculated by plugging in $\pmb{\mathbb{Z}}_{c}(x)$ in Eq. \ref{eq:compsG}. A decomposition of $\hat{\pmb{\theta}}_{s_2}$ reveals that the residual correction term is now included in the regression coefficient $\hat{\pmb{\theta}}_{s_2}$.

\begin{subequations}\label{eq:extpsynth}
	\begin{align}
	\hat{Y}_{c,G,EXTPSYNTH} & =\hat{\bar{\pmb{\mathbb{Z}}}}_{c,G}^{\top}\hat{\pmb{\theta}}_{c,s_2} \label{eq:extpsynth_pest} \\
	\hat{\var}(\hat{Y}_{c,G,EXTPSYNTH})& =
	\hat{\bar{\pmb{\mathbb{Z}}}}_{c,G}^{\top}\hat{\pmb{\Sigma}}_{\hat{\pmb{\theta}}_{c,s_2}}
	\hat{\bar{\pmb{\mathbb{Z}}}}_{c,G}
	+ \hat{\pmb{\theta}}^{\top}_{c,s_2}\hat{\pmb{\Sigma}}_{\hat{\bar{\pmb{\mathbb{Z}}}}_{c,G}}\hat{\pmb{\theta}}_{c,s_2} \label{eq:extpsynth_var}
	\end{align}
\end{subequations}

However, it is important to note that $\bar{\hat{R}}_{c,G} = 0$ under the extended regression model only holds if the sample plots $x_1, ..., x_l$ of a cluster are \textit{all} either inside our outside the small area, i.e. $M_G(x)\equiv M(x)$, and thus $I_{c,G}(x)=\frac{M_{G}(x)}{M(x)}$ can only take the values 1 or 0. \citet{mandallaz2016} assumed that the effects on the estimates should be negligible as the number of occasions where $M_{G}(x) < M(x)$ was considered to be small in practical implementations. It was thus a further objective of this study to investigate the actual occurrences and effects of this phenomenon by comparing the estimates of \extpsynth{} to those of \psmall{}. % where the estimates stay unaffected

% ----------------------------- %
\subsection{Measures of estimation accuracy}

The estimation precision was quantified by the estimation error, which is the ratio of the standard error and the point estimate:

\begin{equation}\label{eq:error}
error_{[\%]}=\frac{\sqrt{\hat{\var}(\hat{Y})}}{\hat{Y}}*100
\end{equation}

We further calculated the 95\% confidence interval for each estimate for visualization purposes. The confidence intervals can also be used heuristically for hypothesis testing to determine whether the point estimates of the three estimators for a given small area are statistically different. The confidence intervals for the SRS estimator can be obtained as:

\begin{equation}\label{ci_1phase}
CI_{1-\alpha}(\hat{Y})=\bigg{\lbrack}\hat{Y}-t_{n_{2}-1, 1-\frac{\alpha}{2}}\sqrt{\hat{\var}(\hat{Y})},
\hat{Y}+t_{n_{2}-1, 1-\frac{\alpha}{2}}\sqrt{\hat{\var}(\hat{Y})}\bigg{\rbrack}
\end{equation}

The confidence intervals for the \psmall{} and \extpsynth{} estimates are calculated as:

\begin{equation}\label{ci_2phase_sae}
CI_{1-\alpha}(\hat{Y})=\bigg{\lbrack}\hat{Y}-t_{n_{2,G}-1, 1-\frac{\alpha}{2}}\sqrt{\hat{\var}(\hat{Y})},
\hat{Y}+t_{n_{2,G}-1, 1-\frac{\alpha}{2}}\sqrt{\hat{\var}(\hat{Y})}\bigg{\rbrack}
\end{equation}

For the \psynth{} estimates, the confidence intervals are

\begin{equation}\label{ci_2phase_global}
CI_{1-\alpha}(\hat{Y})=\bigg{\lbrack}\hat{Y}-t_{n_{2}-p, 1-\frac{\alpha}{2}}\sqrt{\hat{\var}(\hat{Y})},
\hat{Y}+t_{n_{2}-p, 1-\frac{\alpha}{2}}\sqrt{\hat{\var}(\hat{Y})}\bigg{\rbrack}
\end{equation}

\noindent with $p$ being the number of parameters used in the regression model including the intercept term.\\

In order to address the potential benefits of the small area estimators compared with the SRS approach, we calculated the \textit{relative efficiency} (Eq. \ref{eq:releff}) which can be interpreted as the relative sample size under SRS needed to achieve the variance under the double sampling estimators.

\begin{equation}\label{eq:releff}
rel.eff=\frac{\hat{\var}_{SRS}(\hat{Y})}{\hat{\var}_{SAE_{2phase}}(\hat{Y})}
\end{equation}

\newpage



% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\section{Case study}
\label{sec:CaseStudy}

%This section describes the actual implementation of the proposed small area estimators (Section \ref{sec:estimators}) under the cluster design of the German NFI (Section \ref{sec:germanNFI}) in the federal state Rhineland-Palatinate.

\subsection{Study area and small area units}
\label{sec:studyarea}

The German federal state Rhineland-Palatinate (\textit{RLP}) is located in the western part of Germany and borders Luxembourg, France and Belgium. With 42.3\% (appr. 8400 km$^2$) of the entire state area (19850 km$^2$) covered by forest, RLP is one of the two states with the highest forest coverage among all federal states of Germany \citep{bwi3}. The forests of RLP are further characterised by a pronounced diversity in bioclimatic growing conditions that have strong influence on the local growth dynamics as well as tree species composition \citep{gauer2005} and are further characterised by large variety of forest structures ranging from characteristic oak coppices (Moselle valley), pure spruce, beech and scots pine forests (i.a. Hunsr{\"u}ck and Palatinate forest) up to mixed forests comprising variable proportions of oak, larch, spruce, Scots pine and beech. Around 82\% of the forest area in RLP are mixed forest stands and 69\% of the forest area exhibit a multi-layered vertical structure. The forest area of RLP are divided into 3 ownership classes, i.e. state forest (27\%), communal forest (46\%) and privately owned forest (27\%). The forest service of RLP has the legal mandate to sustainably manage the state and communal forest area (73\% of the entire forest area), including forest planning, harvesting and the sale of wood \citep{lwaldg_rlp}. For this reason, the entire forest area has been spatially organised in 3 main hierarchical management units (Figure \ref{fig:StudyArea}). On the upper level, RLP has been divided into 45 Forst{\"a}mter (\textit{FA}), which are further divided into a total number of 405 Forstreviere (\textit{FR}). The next level are the forest stands (104'184 in total) for which expert judgements are conducted by SFIs in a 5 to 10 year period in order to set up management strategies for the upcoming 10 years. The FAs and FRs constituted the SA units for which design-based small area estimations of the mean standing timber volume were calculated by incorporating the available terrestrial inventory data of the BWI3 in the estimators described in Section \ref{sec:estimators}. The average area of the SA units was 43'777 ha on the FA-level, and 4624 ha on the FR level.

% | managment level | average area (min-max)  | average no cluster (plots) | min no. cluster (plots | max no. cluster (plots |
%   FA                43'777 ha  (17367 - 125423)     46 (128)                            11 (36)            64 (198)
%   FR                4624 ha   (0.68 - 43284)         5  (14)                            0 (0)             13 (34)
%   stand level       6 ha     (0.03 ha - 73)          0 (0)                              0 (0)             2 (4)


% Add Graphic 1:
% - Graphic of RLP with "zoom" in the 3 managament units (or later all together in Graphic

% Add in text:
% - add information on the (average) spatial area of each sae-level

% Notes to myself:
% - in the original forstrevier layer, we have 427 FR units but 21 of them are not covered by woefis-layer (so no state- and communal forest), and 1 is the "Bundesforstamt" not considered by us

% ----------------------------------------------------------------------- %
\subsection{Terrestrial sample}

Rhineland-Palatinate (RLP) is covered by a 2x2 km inventory grid of the German NFI. In the last inventory (BWI3) conducted in the year 2013, timber volume information was derived for 2810 clusters (8092 plots) in the field survey. The local timber volume density on the plot and cluster level for this sample was consequently calculated according to Section \ref{sec:srs_estimator}. In the framework of this survey, the plot center coordinates were re-measured with the differential global satellite navigation system (DGPS) technique. Knowledge about the exact plot positions were considered crucial to provide optimal comparability between the terrestrial observations and the information derived from the auxiliary information. A comparison of the DGPS coordinates with the so-far used target coordinates revealed that 90\% of all horizontal deviations lay in the range of 25 meters. A detailed analysis of horizontal DGPS errors in RLP by \citet{lambrecht2017} indicated that 80\% of the plots should not exceed horizontal DGPS errors of 8 meters. For 162 plots, the DGPS coordinates were replaced by their target coordinates due to missingness or implausible values. The terrestrial sample size $n_{2,G}$ within the FA units was 46 clusters on average and ranged between 11 and 64. Within the FR units, $n_{2,G}$ was considerably smaller with an average of 5 clusters and a range between 0 and 13.

\begin{figure}[H]
	\centering
	\resizebox{0.85\hsize}{!}{\includegraphics*{fig/SAunitsRLP.png}}
	\caption{\textit{Left}: Study area with delineated FA forest management units. \textit{Right}: Example for each of the three management units (from top to bottom): FA, FR and forest stand unit overlayed with the extended double-sampling cluster design. \textit{Green}: Forest stand polygon layer defining the forest area of this study.}
	\label{fig:StudyArea}
\end{figure}

% ----------------------------------------------------------------------- %
\subsection{Extension to double-sampling design}
\label{ext_to_2phase}

In order to apply the small area estimators (Section \ref{sec:SAestimators}), the existing NFI design was extended to a double-sampling design by densifying the existing systematic 2x2 km grid to a grid size of 500x500 m that constituted the large first phase $s_1$ in accordance to Section \ref{sec:inf_pop} (Figure \ref{fig:StudyArea}, \textit{right}). The existing terrestrial phase $s_2$ was consequently integrated by replacing the target coordinates of the respective $s_1$ clusters by the terrestrially measured DGPS coordinates. For our study, we restricted the sampling frame to the communal and state forest. The forest/non-forest decision for each plot was thereby made by a spatial intersection of the plot center coordinates with a polygon layer of the communal and state forest stands provided by the forest service. Using this stand layer provided the advantage to consistently apply the same forest/non-forest definition to the entire sample $s_1$ in order to decide about excluding or including a plot in the sampling frame. The terrestrial sample size $n_2$ was thus reduced to 2055 clusters (5791 plots). Table \ref{tab:fieldata} provides a short descriptive summary about the volume densities and the main attributes of the NFI plots located in the state and communal forest sampling frame. The densification led to an average sample size $n_{1,G}$ of 759  clusters (range: 246 -- 1022) in the FA units, and 88 clusters (range: 1 -- 194) in the FR units.

\input{tab/table_fieldmeasuredvals.tex}


% NOTES:
%
% Add Table:
% provide table of "forest characteristics" in RLP
% adress sample sizes before and after extension (table?)
%
% move this to discussion:
% It should however be mentioned that a discrepancy between the terrestrially made forest/non-forest decision and that based on the polygon stand layer can lead to missing responses in the terrestrial sample $s_2$. This occurs if a terrestrial plot $x_l \in s_2$ does not provide the terrestrial response variable although its plot center would theoretically fall within the boundaries of the stand layer. For these cases, it is important to note that according to the double sampling estimator described in Section \ref{sec:SAestimators}, the plots of a cluster can either only belong to the sample $s_2$ or $s_1$. The missing terrestrial plot information $Y(x)$ can thus not be replaced by a prediction $\hat{Y}(x)$, i.e. by establishing a plot $x \in s_1$ instead, and has thus to be treated as a non-response.\par
%
%  "This extension led to a considerable increase of the sample size $n_{1,G}$ in the small area units of both, the FA and FR level."
% - Show (theoretical) increase in sample sizes by extension to 2phase scheme 
%   --> these sample sizes are in the following reduced by missing rs-info
%


% ----------------------------------------------------------------------- %
% Table xx provides an overview of the terrestrial sample sizes on these management levels for the state and communal forest areas.

% \input{terrSamplsizeFoaFuWa.tex}


% average no. plots / clusters; average area of all three units (divided by state + communal forest & entire forest area)

% --> this is only for communal & state forest area:
% | managment level | average area (min-max)  | average no cluster (plots) | min no. cluster (plots | max no. cluster (plots |
%   FA                43'777 ha  (17367 - 125423)     46 (128)         11 (36)            64 (198)
%   FR                4624 ha   (0.68 - 43284)         5  (14)          0 (0)             13 (34)
%   stand level       6 ha     (0.03 ha - 73)          0 (0)            0 (0)             2 (4)

% - Verwaltungsebenen: management levels (Forstamt, Revier, Bestände) -> durschnittliche Flächengrössen (für die sollen die sae schätzungen gemacht werden)
% - evtl bereits Stichprobenzahlen generell und innerhalb der Managementenheiten nennen (das ginge dirket hinsichltich des eigentlichen Themas)
%   (das generelle Problem der Stichprobenanzahl in diesen Einheiten wurde ja schon in der Einleitung angesprochen, also könnte man
%    hier direkt ein Beispiel geben) --> hier noch getrennt nach gesamter Wald und nur Woefis-Wald (Tabelle, Grpahik)
% - warum RLP ? (neues Informationssystem, Interesse an effizienteren Methoden)
% wir nennen Fortamt einfach 'FA-level' und Forstrevier einfach 'FR-level' :-)
% Info: 45 Forstämter without Bundesforstamt; 426 Reviere without Bundesforstamt
% mention that the boundaries of all these management units are well-defined by polygon masks (that were used to extract the sampling
% frame)
% ----------------------------------------------------------------------- %


% ----------------------------------------------------------------------- %
% ----------------------------------------------------------------------- %
\subsection{Auxiliary data}
\label{sec:auxinfo}

% ----------------------------------------- %
\subsubsection{LiDAR canopy height model}
\label{sec:chm}

A prerequisite for the application of the suggested two-phase small area estimators is the identification of suitable auxiliary data available over the entire study area. From 2003 to 2013, the topographic survey institution of RLP conducted an airborne laserscanning acquisition over the entire federal state during leaf-off conditions in order to derive a countrywide digital terrain model (DTM) as well as a digital surface model (DSM). For this study, the recorded ALS data was used to create a canopy height model (CHM) in raster format, providing discrete information about the canopy surface height of the forest area in a spatial resolution of 5 meters (Fig. \ref{fig:Auxvars}, \textit{top}). The CHM was calculated as the difference between the digital terrain model and the digital surface model that were derived by a Delauney interpolation of the ground and first ALS pulses respectively. A more detailed description of the procedure can be found in \citet{hill2017a}. The CHM provided the most valuable information to be used in the OLS regression model for predicting the timber volume on the plot and cluster level. However, it should be noted that the prolonged acquisition period of the ALS campaign led to the possibility of poor temporal alignment with the BWI3 survey, sometimes up to 10 years. In addition, the quality of the CHM varied substantially as ALS technology evolved over the years.  For example, the ALS acquisitions recorded in 2002 and 2003 exhibited particularly poor quality with about only 0.04 point per m$^2$, whereas more recent datasets contained more than 5 points per m$^2$. Furthermore, CHM information was not available at 16 sample locations due to sensor failures. These plots were deleted from the sampling frame and treated as missing at random. This assumption was considered to be reasonable as the respective sample locations did not exclude specific forest structures.

% ---------------------------------------------- %
\subsubsection{Tree species map}
\label{sec:tspecclass}

Additional auxiliary data was derived from a countrywide satellite-based classification map predicting the five main tree species \citep{stoffels2015}, i.e. European beech, Sessile and Pedunculate oak, Norway spruce, Douglas fir and Scots pine (Fig. \ref{fig:Auxvars}, \textit{bottom}). The tree species map has a grid size of 5x5 m and was calculated from 22 bi-temporal satellite images (SPOT5 and RapidEye) using a spatially adaptive classification algorithm \citep{stoffels2012}. As timber volume estimation on the tree level is often based on species-specific biomass and volume equations, the use of tree species information has often been stated as a key factor for improving the precision of timber volume estimates \citep{white2016}. In this respect, incorporating the tree species map was particularly attractive as it predicts five of the seven tree species that are used in the BWI3 taper functions \citep{kublin2013} to calculate the timber volume of a sample tree. However, due to unavailable satellite data, the tree species map excluded one large patch with an area of 415 km$^2$ in the south-west part of RLP covering an entire FA unit consisting of 10 FR units. In 9 additional FR units, the tree species information was also missing for a subset of the sample locations due to two additional patches with areas of 76 km$^2$ and 100 km$^2$ respectively in the northern part of RLP. For these 19 FR units, small area estimation was thus restricted to using only the available CHM information in the regression model. Thus, 411 of 5791 sample locations (approximately 7\%) used to fit the regression model were affected by missing tree species information. A summary of the sample sizes and missing auxiliary data for both the CHM and the tree species map is provided in Table \ref{tab:ssize}.

% neu:
\begin{table}[H]
	\begin{center}
		\caption{Sample size for each phase in entire study area. $n_{\{1,2\},plots}$: number of plots. $n_{\{1,2\}}$: number of clusters. TSPEC: tree species map information.}
		\vspace{0.2cm}
		\label{tab:ssize}
		{\small %
			\begin{tabular}{l|r|r|r|r}
				\hline
				\multicolumn{1}{c|}{\textit{Sampling frame}} & \multicolumn{1}{c|}{\textbf{$n_{1,plot}$}}  & \multicolumn{1}{c|}{\textbf{$n_1$}}  & \multicolumn{1}{c|}{\textbf{$n_{2,plot}$}}  & \multicolumn{1}{c}{\textbf{$n_2$}} \\ % <-- added & and content for each column
				\hline \hline
				communal and state forest & 96'854 & 33'365 & 5791 & 2055\\
				\hspace{5mm} \footnotesize missing CHM & \footnotesize 18 & \footnotesize 10 & \footnotesize 0 & \footnotesize 0\\ % <--
				\hspace{5mm} \footnotesize missing TSPEC & \footnotesize 7060  & \footnotesize 3587 & \footnotesize 414 & \footnotesize 385\\ % <--
				\hspace{5mm} \footnotesize missing CHM \textit{and} TSPEC & \footnotesize 3 & \footnotesize 2 & \footnotesize 0 & \footnotesize 0\\ % <--
				\hspace{5mm} \footnotesize missing CHM \textit{or} TSPEC & \footnotesize 7075 & \footnotesize 3595 & \footnotesize 414 & \footnotesize 385\\ % <--
				\hline \hline
			\end{tabular}
		} %
	\end{center}
\end{table}


% Graphik:
\begin{figure}[H]
	\centering
	\resizebox{0.9\hsize}{!}{\includegraphics*{fig/Auxvars_100dpi.png}}
	\caption{Left: CHM (top) and tree species classification map (bottom) available on the federal state level. Right: Magnified illustration of the supports used to derive the explanatory variables from the auxiliary data.}
	\label{fig:Auxvars}
\end{figure}




% ---------------------------------------------- %
\subsection{Calculation of the explanatory variables}
\label{sec:expvarcalc}

\subsubsection{Canopy height model}

The continuous explanatory variables derived from the CHM were the mean canopy height (\textit{meanheight}) and the standard deviation (\textit{stddev}). The quantities were calculated by evaluating the raster values around each sample location within a circle with a predefined radius of 12 meters, i.e. the support. In order to correct for edge effects at the forest border, the intersection of each support area to the state and communal forest area was determined using a polygon mask provided by the state forest service. The percentage of the support within the forest layer was used as the weight $w(x_l)$ introduced in Eq. \ref{eq:Zc(x)} in order to derive the weighted mean of the explanatory variables on the cluster level. Neglecting the support adjustment would deteriorate the coherence between explanatory variables computed at the forest boundary and the corresponding local density that already includes a potential boundary adjustment, thus introducing unnecessary noise to the model. The boundary adjustment to the support also makes the sampling frame more consistent for the different data sources (Section \ref{ext_to_2phase}).\par
The ALS acquisition year (\textit{ALSyear}) was added as a categorical variable in order to account for the time lag with the terrestrial survey as well as to help explain the heterogeneity in the data introduced by the varying ALS quality. In 2008, a sensor error produced particularly poor ALS quality so the year was divided accordingly into two factor levels, denoted \textit{2008\_1} and \textit{2008}. Furthermore, in order to increase the number of observations per factor level the years 2006 and 2007 were pooled together and the same was done for 2012 and 2013.  The result was nine factor levels denoted as \textit{2002}, \textit{2003}, \textit{2007}, \textit{2008\_1}, \textit{2008}, \textit{2009}, \textit{2010}, \textit{2011} and \textit{2012}.

\subsubsection{Tree species map}

The tree species map was used to predict the main tree species at each sample plot which served as an additional categorical variable called \textit{treespecies}. This involved two consecutive processing steps. In the first step, one of the five tree species was assigned to a sample location if 100\% of the raster values within the edge-corrected support were classified as that species. Otherwise, the sample location was assigned the value 'mixed'. Likewise for the CHM variables, the support radius was 12 meters although the use of different support sizes for each explanatory variable would be in agreement with the two-phase estimators presented in Section \ref{sec:SAestimators}. When using the \textit{treespecies} variable in a regression model, the support size and the percentage threshold parameters had to be optimized in order to minimize the variance within each level which subsequently leads to improved model precision. A detailed analysis and description of the optimal parameter processing for the explanatory variables of the present data set is provided in \citet{hill2017a}. In a second step, the \textit{treespecies} variable was also passed through a calibration model in order to reduce the effects of misclassification errors on the regression model coefficients and to increase model accuracy. The calibration model consisted of a decision tree from a random forest algorithm \citep{breiman2001} that was trained to predict the actual main plot tree species (known for all terrestrial plots) based on available auxiliary variables. These variables were the predicted \textit{treespecies} variable, the mean canopy height and standard deviation of the CHM, as well as the proportion of coniferous trees estimated from the classification map and the growing region derived from a polygon map. The algorithm was grown with 2000 trees considering 3 of the predictors for each split. We thus applied this calibration model to the \textit{treespecies} variable derived at all sample locations $s_1$. Table \ref{tab:classacc} gives the classification accuracies of the \textit{treespecies} variable after calibration.


\begin{table}[H]
	\begin{center}
		\caption{Classification accuracies of the \textit{treespecies} variable before and after calibration. $n_{ref}$: number of terrestrial reference plots. $n_{class}$: number of classified plots.}
		\vspace{0.2cm}
		\label{tab:classacc}
		{\small %
			\begin{tabular}{l|c|c|c|c} %8cols
				\hline
				Main plot species & Producer's accuracy[\%] & User's accuracy[\%] & n$_{ref}$ & n$_{class}$ \\
				\hline \hline	
				Beech       & 22.31 & 47.02 & 883 & 419 \\
				Douglas Fir & 24.78 & 48.72 & 230 & 117 \\
				Oak         & 11.07 & 48.48 & 289 & 66 \\
				Spruce      & 53.15 & 61.13 & 651 & 566 \\
				Scots Pine  & 22.91 & 46.07 & 179 & 89 \\
				Mixed       & 84.49 & 64.53 & 3152 & 4127 \\
				\hlineB{2}
				& \multicolumn{2}{l|}{Overall accuracy: 61.96\%} & 5384 & 5384 \\
				\hline \hline
			\end{tabular}
		}%
	\end{center}
\end{table}

%% Here is the table with calibrated and uncalibrated values:
%\begin{table}[H]
%	\begin{center}
%	\caption{Classification accuracies of the \textit{treespecies} variable before and after calibration. $n_{ref}$: number of terrestrial reference plots. $n_{class}$: number of classified plots.}
%	\vspace{0.2cm}
%	\label{tab:classacc}
% {\small %
%	\begin{tabular}{l|c c|c c|c|c c} %8cols
%		\hlineB{1}
%		\multirow{2}{*}{Main plot species} & \multicolumn{2}{c|}{Producer's accuracy[\%]} & \multicolumn{2}{c|}{User's accuracy[\%]} & \multirow{2}{*}{nref} & \multicolumn{2}{c}{nclass} \\ 
%		\cline{2-3} \cline{4-5} \cline{7-8} & uncalib & calib & uncalib & calib & & uncalib & calib \\
%		\hline \hline	
%		 Beech       & 29.56 & 22.31 & 46.11 & 47.02 & 883 & 566 & 419 \\
%		 Douglas Fir & 33.04 & 24.78 & 47.50 & 48.72 & 230 & 160 & 117 \\
%		 Oak         & 47.75 & 11.07 & 24.34 & 48.48 & 289 & 567 & 66 \\
%		 Spruce      & 43.63 & 53.15 & 60.81 & 61.13 & 651 & 467 & 566 \\
%		 Scots Pine  & 55.87 & 22.91 & 29.59 & 46.07 & 179 & 338 & 89 \\
%		 Mixed       & 66.40 & 84.49 & 63.69 & 64.53 & 3152 & 3286 & 4127 \\
%		\hline
%		 & \multicolumn{4}{l|}{Overall accuracy: 54.83\% (61.96\%)} & 5384 & \multicolumn{2}{c}{5384} \\
%		 \hline \hline
%	\end{tabular}
%}%
%	\end{center}
%\end{table}



% ---------------------------------------------- %
\subsection{Regression Model}
\label{sec:regmod}

The model selection process for this study required a substantial time commitment due to sophisticated challenges such as: a) the heterogeneity of the remote sensing data, b) the identification of the optimal support sizes under angle count sampling, and c) the incorporation of tree species information. Here, only a summary of the extensive analysis that was performed is provided but the reader can refer to \citet{hill2017a} if more details are desired\par
The model with highest \adjrsq{} and lowest RMSE was achieved using \meanheight{}, \meanheight{}$^2$, \stddev{}, \alsyear{} and \treespecies{} as main effects, and including interaction terms between \meanheight{} and \alsyear{}, \stddev{} and \alsyear{}, \meanheight{} and \stddev{}, and \meanheight{} and \treespecies{}. Summary information about the \adjrsq{}, RMSE and RMSE\% of the selected models is provided in Table \ref{tab:modacc_modterms}. The two-phase estimators described in Section \ref{sec:SAestimators} derive and apply the regression coefficients and the residuals on the aggregated cluster level. We re-evaluated the model as used in the estimators on the cluster level (formulas given in Appendix) and found improved model fits compared to the plot level (\adjrsq{} of 0.59 and RMSE of 101.61 \mha{} and 33.6\%). The stratification by the ALS acquisition year substantially improved the model fit, indicating that it is an effective means in accounting for the noise in the data caused by ALS quality variations and time-gaps between the ALS and the terrestrial survey. However, the stratification led to a highly unbalanced data set when a further \treespecies{} stratification was included. For this reason, a individual species modeling within each \alsyear{} stratum remained infeasible, but might have further improved the model fit. An additional evaluation of the model's performance within each ALS acquisition year stratum revealed that the quality of the model fit substantially varied between the strata (Table \ref{tab:adj_r2_within}). In particular, values above the overall \adjrsq{} were higher in ALS acquisition years close to the terrestrial survey date compared to years with larger time gaps.\par
As described in Section \ref{sec:tspecclass}, the information of the tree species classification map was missing within 1 FA and 19 FR units. For these small area units, we applied the regression model without the \treespecies{} variable (Table \ref{tab:modacc_modterms}, reduced model). However, the \adjrsq{}s of the full and reduced model were found to be very similar on both the plot and cluster level. This implied that the variance reduction of the reduced model when applied to the two-phase estimators would likely be comparable to that of the full model, which is why a joint evaluation of the estimation results was performed (Section \ref{sec:Res}).

% Table 1:
\input{tab/modacc_modterms.tex}

Concerning the existence of outliers or leverage points in the training set for the model, it should be noted that it is more problematic for \psmall{}, \psynth{} and \extpsynth{} to simply remove them as one might be inclined to do in a model-dependent context. Strictly speaking, outlier removal in the design-based context essentially means that those plots, and implicitly any potentially similar plots that were not realized in the selected sample, have been removed from the sampling frame and are no longer considered part of the forest area of interest. While this may be valid for some obvious typos or measurement errors, it is generally not advisable to manipulate the sampling frame after observing data collected from it, especially when the observation in question lies within the small area of interest. However, for sake of completeness, we conducted an analysis of influential observations \citep[pp. 160--167]{fahrmeir2013} on the plot level for the full regression model. We calculated the leverage values and found that 10\% of all observations exceeding a predefined critical threshold, i.e. twice the average of the hat matrix diagonal entries. Further investigation revealed that several leverage points showed unusually large \meanheight{} values compared to their respective timber volume densities. They tended to occur in ALS acquisition years with longer time gaps to the terrestrial survey date and were thus more likely caused by harvesting activities in the sample plot area.  Although these areas likely affected by harvest should clearly not be removed from the sampling frame, it does provided more justification for the inclusion of the \alsyear{} variable to mitigate these effects.

%Concerning the treatment of outliers or leverage points for model fitting, it should be noted that there is a major difference between the external and internal model approach. In order to ensure the zero-mean-residual property of the \psmall{} and \extpsynth{} estimator under the internal model approach (section \ref{sec:psmall} and \ref{sec:extpsynth}), all observations of the terrestrial sample $s_2$ used for estimation must also be included in the modeling frame. Thus, excluding an observation from the model fit does also require its deletion from the sampling frame, which has to be regarded as an interference with the random sampling process the design-based inference relies on. For this reason, a removal of potential outliers or leverage points is, strictly speaking, only justified if the terrestrial response value or the explanatory variable value turns out to be truly erroneous (e.g. typos or measurement errors). If this is not the case, the removal of outliers or influential data points might increase the model fit, but to the cost of possible bias for the estimates. With respect to these considerations, we conducted an analysis of influential observations \citep[pp. 160--167]{fahrmeir2013} on the plot level for the full regression model. In order to identify implausible observations in the explanatory data, we calculated the \textit{leverage} values and found that the critical threshold of $2p/n$ (i.e. twice the average of the hat matrix' diagonal entries) was exceeded by 10\% of all observations. Further investigation revealed that several leverage points showed unusually large \meanheight{} values associated to their respective timber volume density values. These implausible height values particularly occured in ALSyear acquisition years differing from the terrestrial survey date and were thus much more likely caused by harvesting activities in the sample plot area than erroneous ALS data. A deletion of these plots from the sampling frame was thus not justified due to the reasons given before. Also the remaining leverage points could not be definitely attributed to erroneous auxiliary data and were kept in the data set. The same was true for 10 observation with exceptionally large local density values that were identified as \textit{outliers}.

% Table 2:
\input{tab/mod_r2_lyearstrata_table.tex}

%\begin{equation}\label{eq:R_squared_clust}
%R^2 =  \frac{\sum_{x \in s_2} \Big(\frac{M(x)}{\bar{M_2}}\Big)^2 \Big(\hat{Y}_{c}(x)-\bar{Y}_c(x)\Big)^2}{\sum_{x \in s_2} \Big(\frac{M(x)}{\bar{M_2}}\Big)^2 \Big(Y_{c}(x)-\bar{Y}_c(x)\Big)^2}
%\end{equation}


%% Notes on leverages:
%
% - 568 plots exceed the critical threshold of 2p/n
% - 1/5 (20\%) 
% - leverages that can indeed be assumed to have a significant influence on the regression coefficients particularly were 
%   a) per se small \meanheight{} values associated to small timber volume densities
%   b) unusually large \meanheight{} values associated to small timber volume values. These implausible height values particularly occured in ALSyear acquisition years differing from the terrestrial survey. These leverage points were thus much more likely caused by harvesting activities in the sample plot area than erroneous ALS data. A deletion of these plots from the sampling / modelling frame was thus not justified due to the reasons given before. However, fitting the model without these plots turned out not to have any influence on the regression coefficients and the overall model accuracy. 

% x-values at the boundaries (small and large values) usually have a high leverage. It does not mean that they are invalid / erroneous.

%% NOTES:
%
% - differences: zero-plots included !!! (basically, we here HAVE to use ALL plots for the regression model calibration --> because we use an internal model)
%   --> comment on the (non) removal of outliers / leverage plots: see review-answers --> plots stay in dataset with exception of truly erroneous local density variables
%       'plots kept in the sampling frame (i.e. they are used as x e s2 in the estimators) MUST also be kept in the modelling frame --> to insure the zero-mean-residual assumption'
%       (important: also leverage plots or "outliers" might have a good reason to be kept in the sampling / modelling frame --> think of sherman tree)
%
% for discussion: better than removing plots would be the the use of disturbance classes (Massey --> change estimation) in order to decrease the impact on plots where major cuttings took place
% between the ALS acquisition and the terrestrial survey. However, this is not possible if one height acquisition is available


\newpage
% ======================================================================================================================== %
% NOTES:
% - Study Area **
%   o characteristics of forests, e.g. structural & species diversity
%   o introduce forest districts, show example and quickly mention their reasoning  
% 
% - The German NFI *
%   o cluster sampling, angle-cound sampling, CF-correction at the forest border
%     no. of plots (clusters) original according to BWI-survey
%   o plot locations by DGPS, and expected accuracy and pre-processing (plausibility analyses
%     and replacing by old coordinates if necessary)
%
% - Estimators **
%   o one-phase estimator: write down estimator in HT-style (evtl. Derivation of CF-correction in
%     Appendix)
%   o two-phase psmall cluster
%   o two-phase psynth extended cluster
%   o two-phase psynth cluster
%   (briefly explain:
%    o the estimator like in jss-article, pronounce difference between psmall
%      and psynthext in case of cluster sampling --> special case and research question:
%      how often does it occur and does it make a difference?
%    o explain difference between external and internal model --> this can be the reasoning for
%      using Daniels estimators for our objective: a) "db" --> we do not depent on the model which
%      is a huge advantage if we have medium-level quality data; b) "cluster" --> provided by Daniels
%      estimators in combination with c) "iternal" model building --> g-weight property and
%      considering dependency of regression coefs on the sample 
%
% - Extension of terrestrial sample grid **
%   o rules (?), new sample sizes globally and within saes
%
%
% - Auxililary information and variable derivation **
%   o document missing data at 1-phase grid (separate into s1 and s2) 
%   o maybe: "due to missing remote sensing information at some sample points, the original sample sizes (s2, s1) 
%             were shrinked down to the numbers shwn in table XX" (-> table showing the actual sample sizes)
%  
% - Model building **
%   o refer to calibration method in previous article
%   o refer to comprehensice model evaluations in previous article
%   o present final model
%
%
% 1) Preprocessing of terrestrial inventory data
% 2) Preprocessing of auxiliary information
% 3) Extention to 2-phase sample grid
% 4) Model building
%
%




% NOTES:
% - model formulation was based on the following considerations: a) The mean canopy height has the heighest explanatory power. Since the strength of correlation between meanheight and the timber volume on plot level showed high variation according to the time-lag of up to 10 years between the LiDAR acquisition and the BWI3 terrestrial inventory. and the varying LiDAR quality, the 
%
%
%
%
%


% MENTION:
% - objective: find regression model (formula) to be applied in the sae estimators
% - Specialty here: in the sae estimators, the predictions are generated on the cluster level (thus the regression coefficients are found on the cluster level)
%   (--> and even more important: the residuals considered in the variance est. are also on the cluster level)
%  ==> so for model selection, we looked at the global model performance on the plot as well as the cluster level
%  ==> we also performed individual paramater t-test for each variable on the plot and cluster level. In order to  
%
% - important to recall that the design-based estimators, in which the regression model is used, do not impose any assumptions on the regression model as is the case in the model-dependent estimation framework.
%
% - no terrestrial data removed from the dataset for modelling, as all terrestrial data are used in the internal model (no choice, its specified by the estimators) 
%
% - mention sample sizes here: Due to missingness in the rs-data, the auxiliary variables were calculated for 89'930 sample plots (5384 terrestrial ...)
%
% - Model Validation (compare several models in table --> Alex)
%
% - Design-based Model Inference (new, use design-based var-covar-matrix)
%
% - idea: make a design-based inference of the regression coefficients on cluster level on the robust reg.coef-matrix
%   "whereas the regression analysis in hill et al. 2017a" was carried out on the sample plot level, we here extend
%    the analysis to the cluster level, as this is actually the level the estimators use the regression model predictions"
%

% Feasibility: 
% FA-level: for 44 out of 45 FA-units, the full model could be applied. For one remaining, only the model without tree species was applied.
% FR-level: for xx out of the 405 FR-units, the full model could be applied. For one remaining, only the model without tree species was applied.
%
% ==> show specs for both regression models











